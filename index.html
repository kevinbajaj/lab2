<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  </head>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      Navigation
    </div>
  </nav>
  <body class="jumbotron">
  <h1>
    <div id="where" class="row text-center bg-primary"></div>
  </h1>
  <img id="picture" src="" class="img-rounded center-block">
  <div class="container-fluid">
    <div id="what" class="row"></div>
    <div id="inventory" class="row"></div>
    <div id="next" class="row"></div>
    <div id="interaction" class="row"></div>
  </div>
  
  <script>
    $(function() {
      $("#where").html("booting...");
      where = "strong-hall";

      function refresh() {
        $.get("/" + where, function (data) {
           $("#where").html(data.text);
           $("#picture").attr("src","images/" + data.where);
           if (data.what === undefined || data.what.length === 0) {
              $("#what").html("");
           } else {
              $("#what").html("You can see : ");
              for(var i in data.what) {
                var item = data.what[i];
                $("#what").append(item);
                
                button = $("<button/>");
                button.addClass("btn btn-primary");
                button.text("Take " + item);
                (function(button,where,item) {
                  button.click(function() {
                    $.ajax("/" + where + "/" + item,
                        { success : refresh,
                          type : "DELETE"
                        }
                    );
                    refresh();
                  });
                })(button,where,item);
                $("#what").append(button);
              }
          }

          $("#next").html("");
          for(var i in data.next) {
            $("#next").append(i);
            button = $("<button/>");
            button.addClass("btn btn-info");
            button.text("Go " + i);
            (function(button,dest) {
              button.click(function() {
                where = dest;
                refresh();
              });
            })(button,data.next[i]);
            $("#next").append(button);
          }
        });

        $.get("/" + where + "/interaction", function (interactionData) {
             $("#interaction").html("");
            for(var i in interactionData) {
              personDiv = $("<div/>");
              personDiv.text("User " + interactionData[i] + " is also here.");
              $("#interaction").append(personDiv);
            }
        });

        $.get("/inventory",function (data) {
          if (data === undefined || data.length === 0) {
             $("#inventory").html("You are not carrying anything");
          } else {
             $("#inventory").html("You are carrying : ");
             for(var i in data) {
               var item = data[i];
               $("#inventory").append(item);
               button = $("<button/>");
               button.addClass("btn btn-danger");
               button.text("Drop " + item);
                (function(button,where,item) {
                  button.click(function() {
                    $.ajax("/" + where + "/" + item,
                        { success : refresh,
                          type : "PUT"
                        }
                    );
                    refresh();
                  });
                })(button,where,item);
               $("#inventory").append(button);
            }
          }
        });
      }

      refresh();

    });
  </script>
  </body>
</html>
